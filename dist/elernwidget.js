var ElernWidget=function(e){"use strict";const n={formId:"student-application-form",apiEndpoint:"https://entadminapi.newron.in/addm_lead_source/get_enquiry_fields",templateId:8,style:{layout:"inline",primaryColor:"#ff0000",backgroundColor:"#ffffff",textColor:"#000000",borderRadius:"4",fontSize:"12",fontFamily:"sans-serif",previewSize:"large",gap:"0.5rem"},submitButton:{text:"APPLY NOW",backgroundColor:"#ff0000",textColor:"#ffffff",borderRadius:"4"}},t={name:"Something is wrong - Default",fields:[{id:1,type:"text",label:"Enter Student's Name",required:!0,field:"name",width:"full",order:1},{id:2,type:"email",label:"Enter Email Address",required:!0,field:"email",width:"full",order:2},{id:3,type:"tel",label:"Enter Mobile Number",required:!0,field:"mobile",width:"full",order:3},{id:5,type:"select",label:"Select State",required:!0,field:"state",width:"full",order:5},{id:6,type:"select",label:"Select City",required:!0,field:"city",width:"full",order:6},{id:7,type:"select",label:"Select School Applying For",required:!0,field:"school",width:"full",order:7},{id:8,type:"select",label:"Select Class Applying For",required:!0,field:"class",width:"full",order:8},{id:9,type:"select",label:"Select Wing",required:!0,field:"wing",width:"full",order:9},{id:10,type:"select",label:"Where did you hear about us?",required:!0,field:"source",width:"full",order:10}],style:{layout:"inline",primaryColor:"#ff0000",backgroundColor:"#ffffff",textColor:"#000000",borderRadius:"4",fontSize:"12",fontFamily:"poppins",previewSize:"large",gap:"0.5rem",padding:"0rem",margin:"0rem"},setup:{landingPageUrl:"http://127.0.0.1:5500/test.html",mobileVerification:!0,emailVerification:!0,mobileOptions:{mobilebeforeSubmission:!0,mobileafterSubmission:!1},emailOptions:{beforeSubmission:!0,afterSubmission:!1}}};function o(e,n,t="Submit"){if(n)e.disabled=!0,e.style.opacity="0.7",e.style.cursor="not-allowed",e.getAttribute("data-original-content")||e.setAttribute("data-original-content",e.innerHTML),e.innerHTML=`\n        <span class="flex items-center justify-center">\n          <svg class="animate-spin h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n          </svg>\n          ${t}...\n        </span>\n      `;else{e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer";const n=e.getAttribute("data-original-content");n&&(e.innerHTML=n)}}const a="https://entadminapi.newron.in",i="https://studentdevapi.newron.in",r="/addm_lead_source",l="/payment_module",s="https://studentdevapi.newron.in/payment_module/razorpay_payment_success",d="https://studentdevapi.newron.in/payment_module/payment_cancel",c={FORM_DATA:a+r+"/template_fields",VERIFY_EMAIL:a+r+"/verify_email",VERIFY_MOBILE:a+r+"/verify_mobile",SUBMIT_FORM:a+r+"/submit_form",REQUEST_APPOINTMENT:a+r+"/schedule_appointment",PAYMENT:a+r+"/payment",GET_OPTIONS:a+r+"/options",GET_ADV_DROPDOWN:a+r+"/filter_component",CREATE_ORDER:i+l+"/create_addm_order",GET_PAYMENT_GATEWAYS:a+"/entity_dropdown/getAllPaymentDropDownAddmBuWise",CREATE_PAYMENT_ORDER:i+l+"/create_addm_order"};async function p(e){try{const n={template_id:e.template_id,selector:e.selector};e.dependent_value&&(n.dependent_value=e.dependent_value),e.field_id&&(n.field_id=e.field_id);const t=Object.entries(n).filter((([e,n])=>null!=n)).map((([e,n])=>`${encodeURIComponent(e)}=${encodeURIComponent(n)}`)).join("&"),o=`${c.GET_ADV_DROPDOWN}?${t}`,a=await fetch(o),i=await a.json();if("error"===i.statusCode)throw new Error(i.message);return i.data||[]}catch(e){throw console.error("Error fetching dropdown options:",e),e}}async function m(e,n){try{o(n,!0,"Verifying");const t=await fetch(c.VERIFY_EMAIL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await t.json();if(200!==a.statusCode)throw new Error(a.message);return a}catch(e){throw console.error("Error verifying email:",e),e}finally{o(n,!1)}}const u=e=>{const n=e.slice(0,3);return["+91","+1"].includes(n)};async function f(e,n){try{o(n,!0,"Verifying");const t=await fetch(c.VERIFY_MOBILE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mobile:u(e)?e:`+91${e}`})}),a=await t.json();if(200!==a.statusCode)throw new Error(a.message);return a}catch(e){throw console.error("Error verifying mobile:",e),e}finally{o(n,!1)}}function y(e,n){const t=n.fields.filter((e=>"select"===e.type));!function(e,n,t,o){const a=t.filter((e=>"fixed"===e.field_dependency));a.forEach((t=>{const a=e.querySelector(`[name="field_${t.id}"]`);a&&(a.setAttribute("data-selector",t.selector),a.setAttribute("data-field-id",t.id),async function(e,n,t){try{g(e);x(e,await p({template_id:n.id,selector:t.selector,field_id:t?.id}),t.label)}catch(n){console.error(`Error loading fixed options for ${t.label}:`,n),h(e)}}(a,n,t),o.has(t.id)&&b(a,e,n,t,o))}));const i=t.filter((e=>"dependent"===e.field_dependency));i.forEach((t=>{const a=e.querySelector(`[name="field_${t.id}"]`);a&&(a.setAttribute("data-selector",t.selector),a.setAttribute("data-field-id",t.id),a.setAttribute("data-dependency-field",t.field_dependency_field),a.setAttribute("data-dependency-column",t.field_dependency_column),a.disabled=!0,o.has(t.id)&&b(a,e,n,t,o))}))}(e,n,t,function(e){const n=new Map;return e.forEach((t=>{if("dependent"===t.field_dependency&&t.field_dependency_field&&t.field_dependency_column){const o=e.find((e=>e.selector===t.field_dependency_column||e.field_id?.toString()===t.field_dependency_field?.toString()));o&&(n.has(o.id)||n.set(o.id,[]),n.get(o.id).push({childId:t.id,childSelector:t.selector,dependencyField:t.field_dependency_field,dependencyColumn:t.field_dependency_column}))}})),n}(t))}function b(e,n,t,o,a){e.addEventListener("change",(async e=>{const i=e.target.value,r=a.get(o.id);r&&(!function(e,n,t){const o=new Set;function a(n){n.forEach((n=>{if(o.has(n.childId))return;o.add(n.childId);const i=e.querySelector(`[name="field_${n.childId}"]`);if(i){!function(e){const n=e.closest("div").querySelector("label")?.textContent||"Select";e.innerHTML=`<option value="">Select ${n}</option>`,e.disabled=!0,e.classList.remove("loading","error")}(i);const e=t.get(n.childId);e&&a(e)}}))}a(n)}(n,r,a),i&&await async function(e,n,t,o){for(const a of o){const o=e.querySelector(`[name="field_${a.childId}"]`);if(o)try{g(o);const e={template_id:n.id,selector:a.childSelector,field_id:a?.childId,dependent_value:t,[a.dependencyColumn]:t};x(o,await p(e))}catch(e){console.error("Error updating child dropdown:",e),h(o)}}}(n,t,i,r))}))}function g(e){e.disabled=!0,e.innerHTML='<option value="">Loading...</option>',e.classList.add("loading")}function h(e){e.disabled=!0,e.innerHTML='<option value="">Error loading options</option>',e.classList.add("error")}function x(e,n,t){e.classList.remove("loading","error");const o=t||e.closest("div").querySelector("label")?.textContent||"Select";e.innerHTML=`<option value="">Select ${o}</option>`,Array.isArray(n)&&n.length>0?(n.forEach((n=>{const t=document.createElement("option");t.value=n.value,t.textContent=n.label,e.appendChild(t)})),e.disabled=!1):e.disabled=!0}function v(e){if(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e))return!1;const n=e.split("@");if(2!==n.length)return!1;const[t,o]=n;if(!t||!o)return!1;if(!o.includes("."))return!1;const a=o.split("."),i=a[a.length-1];return!(!i||i.length<2)}function w(e,n){const t=document.querySelector(`input[type="${e}"]`);if(t){const e=t.parentElement.querySelector(".verification-status");if(!e)return;const o={verified:"border-green-500",invalid:"border-red-500",pending:"border-blue-500",neutral:"border-gray-300"};t.classList.remove("border-green-500","border-red-500","border-blue-500","border-gray-300"),t.disabled="verified"===n,o[n]&&t.classList.add(o[n]);const a={verified:'\n        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n        </svg>\n      ',invalid:'\n        <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n        </svg>\n      ',pending:'\n        <svg class="w-5 h-5 text-blue-500 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>\n        </svg>\n      ',neutral:""};e.innerHTML=a[n]||"",e.setAttribute("data-status",n)}}function $(e,n,t){e.className="flex flex-wrap "+("stacked"===t.style?.layout?"flex-col items-stretch flex-start":"flex-row items-center justify-between"),Object.assign(e.style,{backgroundColor:t.style?.backgroundColor,color:t.style?.textColor,fontSize:`${t.style?.fontSize}px`,fontFamily:t.style?.fontFamily,borderRadius:`${t.style?.borderRadius}px`,gap:t.style?.gap,padding:t.style?.padding,margin:t.style?.margin});const o=t?.fields?.sort(((e,n)=>e.order-n.order));o.forEach((n=>{const o=document.createElement("div");o.className="mb-1 "+("full"===n.width?"w-full":"half"===n.width?"w-72":"w-56");const a=document.createElement("label");a.textContent=n.label,a.className="block text-sm font-medium mb-1 ml-1",a.style.color=t.style?.textColor,a.style.fontSize=`${t.style?.fontSize}px`;const i=document.createElement("div");i.className="relative";const r="select"===n.type?document.createElement("select"):document.createElement("input");"select"!==n.type&&(r.type=n.type),r.required=n.required,r.name=`field_${n.id}`,r.setAttribute("data-field-id",n.id),r.setAttribute("data-field-type",n.type),r.setAttribute("data_fixed",n.filter_isfixed),n.field_dependency&&r.setAttribute("data-dependency",n.field_dependency);const l=("email"===n.type||"tel"===n.type)&&n.filter_isfixed;if(r.className=`w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-${t.style.primaryColor} focus:border-${t.style.primaryColor} ${l?"pr-10":""}`,r.style.borderRadius=`${t.style?.borderRadius}px`,r.style.fontSize=`${t.style?.fontSize}px`,"select"===n.type&&async function(e,n,t){const o=document.createElement("option");o.value="",o.textContent=`Select ${n.label}`,e.appendChild(o),"fixed"===n.field_dependency&&n.selector?(e.disabled=!0,o.textContent="Loading...",await p({field_id:n?.id,template_id:t.id,selector:n.selector}).then((t=>{o.textContent=`Select ${n.label}`,Array.isArray(t)&&t.length>0&&(t.forEach((n=>{const t=document.createElement("option");t.value=n.value,t.textContent=n.label,e.appendChild(t)})),e.disabled=!1)})).catch((t=>{console.error(`Error fetching options for ${n.label}:`,t),o.textContent="Error loading options",e.disabled=!0}))):n?.field_options?.length>0&&(n.field_options.forEach((n=>{const t=document.createElement("option");t.value=n.value,t.textContent=n.label,e.appendChild(t)})),e.disabled=!1)}(r,n,t),i.appendChild(r),l){const e=document.createElement("div");e.className="absolute right-3 top-1/2 transform -translate-y-1/2 verification-status",i.appendChild(e),function(e,n){"email"===n?(e.addEventListener("input",(n=>{const t=n.target.value.trim();t?v(t)?C(e,"pending"):C(e,"invalid"):C(e,"")})),e.addEventListener("blur",(n=>{const t=n.target.value.trim();t&&(v(t)||C(e,"invalid"))}))):"tel"===n&&e.addEventListener("input",(n=>{const t=n.target.value.trim();t?/^\d{10}$/.test(t)?C(e,"pending"):C(e,"invalid"):C(e,"")}))}(r,n.type)}o.id=n.label.split(" ").join("_").toLowerCase(),o.appendChild(a),o.appendChild(i),e.appendChild(o)}));const a=document.createElement("div");a.className="w-full mt-4 flex items-start space-x-2 relative";const i=document.createElement("input");i.type="checkbox",i.id="terms-checkbox",i.name="terms",i.required=!0,i.className="mt-1";const r=document.createElement("label");r.htmlFor="terms-checkbox",r.className="text-sm relative",r.style.color=t.style?.textColor,r.style.fontSize=`${t.style?.fontSize}px`;const l=document.createElement("div");l.className="absolute hidden z-50 w-64 p-3 text-sm bg-gray-800 text-white rounded-lg shadow-lg",l.style.bottom="calc(100% + 10px)",l.style.left="0",l.innerHTML='\n    By accepting these terms, you agree to:\n    <ul class="list-disc pl-4 mt-1">\n      <li>Share your information for admission purposes</li>\n      <li>Receive communications about your application</li>\n      <li>Comply with school policies and procedures</li>\n      <li>Verify all provided information is accurate</li>\n    </ul>\n  ';const s=document.createElement("div");s.className="absolute hidden z-50 w-64 p-3 text-sm bg-gray-800 text-white rounded-lg shadow-lg",s.style.bottom="calc(100% + 10px)",s.style.left="0",s.innerHTML='\n    Our privacy policy outlines:\n    <ul class="list-disc pl-4 mt-1">\n      <li>How we collect and use your data</li>\n      <li>Security measures to protect your information</li>\n      <li>Your rights regarding your personal data</li>\n      <li>Our data retention and deletion policies</li>\n    </ul>\n  ';const d=()=>{const e=document.createElement("div");return e.className="absolute w-3 h-3 bg-gray-800 rotate-45",e.style.bottom="-6px",e.style.left="20px",e};l.appendChild(d()),s.appendChild(d());const c=document.createElement("span");c.className="relative inline-block",c.innerHTML=`\n    I agree to the <a href="https://school.elern.io/terms-and-conditions" class="terms-link underline relative inline-block" style="color: ${t.style.primaryColor}">Terms and Conditions</a> \n    and <a href="https://school.elern.io/privacy-policy" class="privacy-link underline relative inline-block" style="color: ${t.style.primaryColor}">Privacy Policy</a>\n  `;const m=c.querySelector(".terms-link"),u=c.querySelector(".privacy-link");m.addEventListener("mouseenter",(()=>{l.style.display="block",l.style.opacity="0",l.style.transition="opacity 0.2s ease-in-out",setTimeout((()=>l.style.opacity="1"),10)})),m.addEventListener("mouseleave",(()=>{l.style.opacity="0",setTimeout((()=>l.style.display="none"),200)})),u.addEventListener("mouseenter",(()=>{s.style.display="block",s.style.opacity="0",s.style.transition="opacity 0.2s ease-in-out",setTimeout((()=>s.style.opacity="1"),10)})),u.addEventListener("mouseleave",(()=>{s.style.opacity="0",setTimeout((()=>s.style.display="none"),200)})),c.appendChild(l),c.appendChild(s),r.appendChild(c),a.appendChild(i),a.appendChild(r),e.appendChild(a);const f=function(e,n){const t=document.createElement("button");t.type="submit",t.id="form-submit-button",t.className="w-full font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 mt-6 relative flex items-center justify-center";const o=document.createElement("span");o.className="button-text",o.textContent=e.submitButton.text;const a=document.createElement("span");return a.className="button-loader hidden flex items-center justify-center",a.innerHTML='\n    <svg class="animate-spin h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n    </svg>\n    Submitting...\n  ',Object.assign(t.style,{backgroundColor:n.style.primaryColor,color:n.style.backgroundColor,borderRadius:`${n.style.borderRadius}px`}),t.appendChild(o),t.appendChild(a),t}(n,t);f.setAttribute("data-original-text",n.submitButton.text);e.querySelector('input[type="checkbox"]').addEventListener("change",(e=>{f.disabled=!e.target.checked,f.style.opacity=e.target.checked?"1":"0.5",f.style.cursor=e.target.checked?"pointer":"not-allowed"})),f.disabled=!0,f.style.opacity="0.5",f.style.cursor="not-allowed",e.appendChild(f),y(e,t)}function C(e,n){const t=e.parentElement.querySelector(".verification-status");if(!t)return;const o={verified:'\n      <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n      </svg>\n    ',invalid:'\n      <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n      </svg>\n    ',pending:'\n      <svg class="w-5 h-5 text-blue-500 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>\n      </svg>\n    '};t.innerHTML=o[n]||"",t.setAttribute("data-status",n)}function k(e,n){const t=e.querySelector("#form-submit-button"),o=t.querySelector(".button-text"),a=t.querySelector(".button-loader");n?(t.disabled=!0,t.style.opacity="0.7",t.style.cursor="not-allowed",o.classList.add("hidden"),a.classList.remove("hidden"),a.classList.add("flex")):(t.disabled=!1,t.style.opacity="1",t.style.cursor="pointer",o.classList.remove("hidden"),a.classList.add("hidden"),a.classList.remove("flex"))}const _="success",S="error",E="warning",z="info",A={[_]:"bg-green-500",[S]:"bg-red-500",[E]:"bg-yellow-500",[z]:"bg-blue-500"},F={[_]:'<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',[S]:'<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',[E]:'<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>',[z]:'<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'};function T(){const e=document.createElement("div");return e.id="toast-container",e.className="fixed top-5 right-5 z-50 flex flex-col items-end space-y-4",e.setAttribute("aria-live","polite"),document.body.appendChild(e),e}function L(e,n=z,t=4e3){const o=document.getElementById("toast-container")||T(),a=document.createElement("div");a.className=`flex items-center p-4 space-x-2 rounded-lg text-white ${A[n]} shadow-md transform transition-all duration-500 translate-x-full opacity-0`,a.innerHTML=`\n          <div class="mr-1 flex-shrink-0">\n            ${F[n]}\n          </div>\n          <div class="text-sm font-medium flex-grow">${e}</div>\n          <button class="ml-3 text-white hover:text-gray-300 focus:outline-none transition-opacity duration-200 flex-shrink-0" aria-label="Close" onclick="this.parentElement.remove()">\n            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n            </svg>\n          </button>\n        `,o.appendChild(a),a.offsetHeight,a.classList.remove("translate-x-full","opacity-0"),a.classList.add("translate-x-0","opacity-100"),setTimeout((()=>{a.classList.add("translate-x-full","opacity-0"),setTimeout((()=>{a.remove()}),500)}),t)}const I={currency:"INR",theme:{color:"#ff0000"}};function P(e,n,t,o){const{onSuccess:a,onError:i,onModal:r}=o,l=JSON.parse(localStorage.getItem("addm_trans")||"{}"),c={key:t.accessKey,amount:e.amount,currency:e.currency,name:n?.applicationdetails.school,description:`Admission Form Fee - ${n?.applicationdetails.program}`,order_id:e.id,image:l.logo||n?.applicationdetails.logo,prefill:{name:n?.applicationdetails.name,email:n?.applicationdetails.email,contact:n?.applicationdetails.mobile||""},notes:{applicationNo:n?.applicationdetails.applicationNo,school:n?.applicationdetails.school,class:n?.applicationdetails.class,wing:n?.applicationdetails.wing,program:n?.applicationdetails.program,gateway_name:t.label,entity_id:l.entity_id,bu_id:l.bu_id,lead_id:l.lead_id,addm_form_fee_id:l.addm_form_fee_id},redirect:!1,callback_url:s,cancel_url:d,theme:I.theme,modal:{ondismiss:function(){r&&r("DISMISSED")},confirm_close:!0,escape:!1},handler:async function(e){if(e.razorpay_payment_id){a({...e,applicationDetails:n,gateway:t,addmTrans:l});try{await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_payment_id:e.razorpay_payment_id,razorpay_order_id:e.razorpay_order_id,razorpay_signature:e.razorpay_signature,addm_trans:l})})}catch(e){console.error("Error notifying backend of payment success:",e),L("Payment successful but failed to update status","warning")}}}},p=new window.Razorpay(c);return p.on("payment.failed",(async function(e){console.error("Payment failed:",e.error),await async function(e){console.log("Payment failure data:",e);try{const n=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e})}),t=await n.json();if(!n.ok)throw new Error(t.message||"Failed to notify backend of payment failure");return t}catch(e){console.error("Error notifying backend of payment failure:",e),L("Failed to update payment status","error")}}({error:e.error,addmTrans:l}),i({...e.error,gateway:t,addmTrans:l})})),p}async function R(e,n,t){try{const o=JSON.parse(localStorage.getItem("addm_trans")||"{}"),a=await async function(e){try{const n=new URLSearchParams(e).toString(),t=`${c.GET_PAYMENT_GATEWAYS}?${n}`,o=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}),a=await o.json();if("error"===a.statusCode)throw new Error(a.message);return(a.data||[]).map((e=>({id:e.value,label:e.label||e.pg_name,type:"razorpay",description:e.description||`Pay using ${e.label||e.pg_name}`,accessKey:e.pg_accesskey,enabled:!0})))}catch(e){throw console.error("Error fetching payment gateways:",e),e}}({bu_id:o.bu_id,session_id:o.session_id,location_id:2});if(!a||0===a.length)throw new Error("No payment gateways available");const i=function(e,n){const t=e?.addm_trans?.paid_amount||e?.fee||0;return D("payment-gateway-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-md w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${n.backgroundColor}; \n        color: ${n.textColor}; \n        font-family: ${n.fontFamily}; \n        font-size: ${n.fontSize}px; \n        gap: ${n.gap};\n      "\n    >\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${n.primaryColor}; \n          color: ${n.backgroundColor};\n          border-top-left-radius: ${n.borderRadius}px;\n          border-top-right-radius: ${n.borderRadius}px;\n        "\n      >\n        <h2 \n          class="text-2xl font-bold"\n          style="font-family: ${n.fontFamily};"\n        >\n          Select Payment Method\n        </h2>\n        <p \n          class="text-sm"\n          style="\n            font-family: ${n.fontFamily};\n            color: ${n.backgroundColor};\n          "\n        >\n          Choose your preferred payment method to continue\n        </p>\n      </div>\n      \n      <div class="p-6">\n        \x3c!-- Amount Display --\x3e\n        <div \n          class="mb-6 text-lg"\n          style="color: ${n.textColor};"\n        >\n          <span class="font-medium">Amount to Pay:</span> \n          <span class="font-bold">₹${t.toFixed(2)}/-</span>\n        </div>\n\n        \x3c!-- Gateway List Container --\x3e\n        <div \n          id="gateway-list" \n          class="space-y-3 max-h-[400px] overflow-y-auto mb-6"\n        >\n          <div class="text-center text-gray-500 py-4">\n            <div class="animate-spin inline-block w-6 h-6 border-2 border-current border-t-transparent rounded-full" style="border-color: ${n.primaryColor};">\n              <span class="sr-only">Loading...</span>\n            </div>\n            <p class="mt-2">Loading payment options...</p>\n          </div>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="flex flex-col space-y-3">\n          <button \n            id="proceed-payment" \n            class="w-full font-bold py-2 px-4 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed"\n            style="\n              background-color: ${n.primaryColor};\n              color: ${n.backgroundColor};\n              border-radius: ${n.borderRadius}px;\n            "\n            disabled\n          >\n            Pay Now\n          </button>\n\n          <button \n            id="cancel-gateway-selection" \n            class="w-full font-bold py-2 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor}20;\n              color: ${n.textColor};\n              border-radius: ${n.borderRadius}px;\n            "\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  `)}(e,t.style),r=i.querySelector("#gateway-list"),l=i.querySelector("#proceed-payment");let s=null;r.innerHTML=a.map((e=>`\n      <div \n        class="payment-gateway-option p-4 border rounded-lg cursor-pointer transition duration-300" \n        data-gateway-id="${e.id}"\n        style="border-color: ${t.style.primaryColor}40;"\n      >\n        <div class="flex items-center">\n          <input \n            type="radio" \n            name="gateway" \n            value="${e.id}" \n            ${e.enabled?"":"disabled"}\n            style="accent-color: ${t.style.primaryColor};"\n          >\n          <div class="flex-1 ml-3">\n            <div style="font-weight: 500; color: ${t.style.textColor}">\n              ${e.label}\n            </div>\n            <div style="font-size: 0.875rem; color: ${t.style.textColor}80">\n              ${e.description}\n            </div>\n          </div>\n        </div>\n      </div>\n    `)).join("");r.querySelectorAll('input[type="radio"]').forEach((e=>{e.addEventListener("change",(e=>{const n=e.target.closest(".payment-gateway-option").dataset.gatewayId;s=a.find((e=>e.id===parseInt(n))),document.querySelectorAll(".payment-gateway-option").forEach((e=>{e.style.borderColor=`${t.style.primaryColor}40`,e.style.backgroundColor=""})),s?.enabled&&(e.target.closest(".payment-gateway-option").style.borderColor=t.style.primaryColor,e.target.closest(".payment-gateway-option").style.backgroundColor=`${t.style.primaryColor}10`,l.disabled=!1,l.style.opacity="1",l.style.cursor="pointer")}))}));const d=async()=>{if(s&&(N(i),s.type.toLowerCase().includes("razorpay")))try{await M(e,s,n)}catch(e){n.onError({description:e.message||"Failed to process payment",gateway:s})}};l.addEventListener("click",d),i.querySelector("#cancel-gateway-selection").addEventListener("click",(()=>{N(i),n.onModal&&n.onModal("CANCELLED")})),q(i)}catch(e){console.error("Payment gateway selection failed:",e),n.onError&&n.onError(e)}}async function M(e,n,t){try{if(!await new Promise((e=>{const n=document.createElement("script");n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=()=>e(!0),n.onerror=()=>{alert("Failed to load Razorpay SDK"),e(!1)},document.body.appendChild(n)})))throw new Error("Failed to load payment gateway");const o=await async function(e,n){try{const e=JSON.parse(localStorage.getItem("addm_trans")||"{}"),t=[{lead_id:parseInt(e.lead_id),payment_status_id:parseInt(e.payment_status_id),paid_amount:parseInt(e.paid_amount),addm_form_fee_id:parseInt(e.addm_form_fee_id),discount_coupon:null,payment_date_time:e.payment_date_time,transaction_no:e.transaction_no,order_id:null,receipt_remarks:e.receipt_remarks||"Website Payment"}],o={payment_gateway:parseInt(n.id),amount:parseInt(e.paid_amount),currency:"INR",entity_id:parseInt(e.entity_id),session_id:parseInt(e.session_id),location_id:2,student_id:parseInt(e.lead_id),payment_reference_id:parseInt(e.addm_form_fee_id),payment_reference_json:t,parent_user_id:parseInt(e.parent_user_id||0)};Object.keys(o).forEach((e=>{null!==o[e]&&void 0!==o[e]||delete o[e]}));const a=await fetch(c.CREATE_ORDER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),i=await a.json();if("error"===i.statusCode)throw new Error(Array.isArray(i.message)?i.message.join(", "):i.message);return i.data}catch(e){throw console.error("Error creating Razorpay order:",e),e}}(0,n);if(!o)throw new Error("Failed to create order");P(o,e,n,t).open()}catch(e){console.error("Payment initialization failed:",e),t.onError&&t.onError({description:e.message||"Payment initialization failed",gateway:n})}}function D(e,n){const t=document.createElement("div");return t.id=e,t.className="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-screen flex items-center justify-center w-full hidden",t.innerHTML=`\n          ${n}\n    `,document.body.appendChild(t),t}function q(e){e.classList.remove("hidden")}function N(e){e.classList.add("hidden")}function j(e,n){return D("payment-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-md w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${n.backgroundColor}; \n        color: ${n.textColor}; \n        font-family: ${n.fontFamily}; \n        font-size: ${n.fontSize}px; \n        gap: ${n.gap};\n      "\n    >\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${n.primaryColor}; \n          color: ${n.backgroundColor};\n          border-top-left-radius: ${n.borderRadius}px;\n          border-top-right-radius: ${n.borderRadius}px;\n        "\n      >\n        <h2 \n          class="text-2xl font-bold"\n          style="font-family: ${n.fontFamily};"\n        >\n          Hey ${e.name}!\n        </h2>\n        <p \n          class="text-sm"\n          style="\n            font-family: ${n.fontFamily};\n            color: ${n.backgroundColor};\n          "\n        >\n          Thank you for applying to ${e.school}. Please complete the payment to proceed with the admission process.\n        </p>\n      </div>\n      <div class="p-6">\n        <div \n          class="mb-6 space-y-2"\n          style="\n            color: ${n.textColor};\n            font-family: ${n.fontFamily};\n            font-size: ${n.fontSize}px;\n          "\n        >\n          <p><span class="font-medium">School Applied for:</span> ${e.school}</p>\n          <p><span class="font-medium">Class Applied for:</span> ${e.class}</p>\n          <p><span class="font-medium">Wing Applied for:</span> ${e.wing}</p>\n          <p><span class="font-medium">Program Applied for:</span> ${e.program}</p>\n          <p><span class="font-medium">Application Form Fee:</span> Rs ${e.fee}/-</p>\n        </div>\n        \n        <div class="flex flex-col space-y-3">\n          <button \n            id="request-appointment" \n            class="w-full py-2 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor}99;\n              color: ${n.backgroundColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${n.fontSize}px;\n            "\n          >\n            Request a appointment\n          </button>\n          <button \n            id="pay-application-fee" \n            class="w-full py-2 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor};\n              color: ${n.backgroundColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${n.fontSize}px;\n            "\n          >\n            Pay Application Form Fee\n          </button>\n        </div>\n      </div>\n    </div>\n  `)}function O(e,n,t){const o=D("payment-success-modal",`\n    <div \n      class="rounded-lg shadow-xl w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${n.backgroundColor}; \n        color: ${n.textColor}; \n        font-family: ${n.fontFamily}; \n        font-size: ${n.fontSize}px; \n        gap: ${n.gap};\n        max-width: 80%\n      "\n    >\n      \x3c!-- Header --\x3e\n      <div \n        class="px-4 sm:px-6 py-4" \n        style="\n          background-color: ${n.primaryColor}; \n          color: ${n.backgroundColor};\n          border-top-left-radius: ${n.borderRadius}px;\n          border-top-right-radius: ${n.borderRadius}px;\n        "\n      >\n        <div class="flex justify-between items-start sm:items-center gap-4">\n          <div class="flex-1">\n            <h2 \n              class="text-xl sm:text-2xl font-bold mb-1"\n              style="font-family: ${n.fontFamily};"\n            >\n              Payment Successful\n            </h2>\n            <p \n              class="text-xs sm:text-sm"\n              style="\n                font-family: ${n.fontFamily};\n                color: ${n.backgroundColor};\n              "\n            >\n              Thank you! Your application form payment has been processed successfully.\n            </p>\n          </div>\n          <div \n            class="rounded-full p-2 flex-shrink-0"\n            style="background-color: ${n.primaryColor}80;"\n          >\n            <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path \n                stroke-linecap="round" \n                stroke-linejoin="round" \n                stroke-width="2" \n                d="M5 13l4 4L19 7"\n                style="stroke: ${n.backgroundColor};"\n              ></path>\n            </svg>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Content --\x3e\n      <div class="p-4 sm:p-6">\n        \x3c!-- Content sections with responsive grid --\x3e\n        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n          \x3c!-- Applicant Details --\x3e\n          <div \n            class="space-y-2"\n            style="\n              color: ${n.textColor};\n              font-family: ${n.fontFamily};\n            "\n          >\n            <h3 \n              class="text-base sm:text-lg font-semibold mb-3"\n              style="color: ${n.textColor};"\n            >\n              Applicant Details\n            </h3>\n            <div class="space-y-2 text-sm sm:text-base">\n              <p><span class="font-medium">Application No:</span> ${e.applicationNo}</p>\n              <p><span class="font-medium">Name:</span> ${e.name}</p>\n              <p><span class="font-medium">School:</span> ${e.school}</p>\n              <p><span class="font-medium">Class:</span> ${e.class}</p>\n              <p><span class="font-medium">Wing:</span> ${e.wing}</p>\n              <p><span class="font-medium">Program:</span> ${e.program}</p>\n            </div>\n          </div>\n\n          \x3c!-- Payment Details --\x3e\n          <div \n            class="space-y-2"\n            style="\n              color: ${n.textColor};\n              font-family: ${n.fontFamily};\n            "\n          >\n            <h3 \n              class="text-base sm:text-lg font-semibold mb-3"\n              style="color: ${n.textColor};"\n            >\n              Payment Details\n            </h3>\n            <div class="space-y-2 text-sm sm:text-base">\n              <p><span class="font-medium">Amount Paid:</span> ₹${e.fee}/-</p>\n              <p><span class="font-medium">Transaction ID:</span> ${e.transactionId}</p>\n              <p><span class="font-medium">Date & Time:</span> ${e.paymentDateTime}</p>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Next Steps --\x3e\n        <div \n          class="mt-6"\n          style="\n            color: ${n.textColor};\n            font-family: ${n.fontFamily};\n          "\n        >\n          <h3 \n            class="text-base sm:text-lg font-semibold mb-3"\n            style="color: ${n.textColor};"\n          >\n            Next Steps\n          </h3>\n          <ul class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">\n            ${["Download Elern Mobile App to complete admission process","Complete the Admission Application Form","Upload necessary admission documents","Check updates for Interview/Written Exam"].map((e=>`\n              <li class="flex items-start sm:items-center gap-2">\n                <span \n                  class="rounded-full p-1 flex-shrink-0 mt-0.5 sm:mt-0"\n                  style="background-color: ${n.primaryColor}20;"\n                >\n                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: ${n.primaryColor};">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />\n                  </svg>\n                </span>\n                <span class="flex-1">${e}</span>\n              </li>\n            `)).join("")}\n          </ul>\n        </div>\n\n        \x3c!-- App Download Section --\x3e\n        <div \n          class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-4"\n          style="\n            color: ${n.textColor};\n            font-family: ${n.fontFamily};\n          "\n        >\n          <p class="text-sm sm:text-base">Download Elern Student App</p>\n          <div class="flex gap-4">\n            <a href="#" class="hover:opacity-80 transition-opacity w-[120px]">\n              <img src="/api/placeholder/120/40" alt="App Store" class="w-full h-auto rounded">\n            </a>\n            <a href="#" class="hover:opacity-80 transition-opacity w-[120px]">\n              <img src="/api/placeholder/120/40" alt="Play Store" class="w-full h-auto rounded">\n            </a>\n          </div>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="mt-6 flex flex-col sm:flex-row gap-3">\n          <button \n            id="download-receipt" \n            class="w-full sm:flex-1 font-bold py-2.5 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor};\n              color: ${n.backgroundColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${parseInt(n.fontSize)-1}px;\n            "\n          >\n            Download Receipt\n          </button>\n\n          <button \n            id="close-payment-success" \n            class="w-full sm:flex-1 font-bold py-2.5 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor}20;\n              color: ${n.textColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${parseInt(n.fontSize)-1}px;\n            "\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  `);return setTimeout((()=>{const e=o.querySelector("#close-payment-success"),n=o.querySelector("#download-receipt");e.addEventListener("click",(()=>{N(o)})),n.addEventListener("click",(()=>{L("Downloading payment receipt...","info")}))}),0),o}function B(e,n){const t=D("payment-failed-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-md w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${n.backgroundColor}; \n        color: ${n.textColor}; \n        font-family: ${n.fontFamily}; \n        font-size: ${n.fontSize}px; \n        gap: ${n.gap};\n      "\n    >\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${n.primaryColor}; \n          color: ${n.backgroundColor};\n          border-top-left-radius: ${n.borderRadius}px;\n          border-top-right-radius: ${n.borderRadius}px;\n        "\n      >\n        <div class="flex justify-between items-center">\n          <div>\n            <h2 \n              class="text-2xl font-bold mb-1"\n              style="font-family: ${n.fontFamily};"\n            >\n              Payment Failed\n            </h2>\n            <p \n              class="text-sm"\n              style="\n                font-family: ${n.fontFamily};\n                color: ${n.backgroundColor};\n              "\n            >\n              We're sorry, but your payment couldn't be processed.\n            </p>\n          </div>\n          <div \n            class="rounded-full p-2"\n            style="background-color: ${n.primaryColor}80;"\n          >\n            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path \n                stroke-linecap="round" \n                stroke-linejoin="round" \n                stroke-width="2" \n                d="M6 18L18 6M6 6l12 12"\n                style="stroke: ${n.backgroundColor};"\n              ></path>\n            </svg>\n          </div>\n        </div>\n      </div>\n\n      <div class="p-6">\n        \x3c!-- Transaction Details --\x3e\n        <div \n          class="mb-6 space-y-2"\n          style="\n            color: ${n.textColor};\n            font-family: ${n.fontFamily};\n          "\n        >\n          <h3 \n            class="text-lg font-semibold mb-3"\n            style="color: ${n.textColor};"\n          >\n            Transaction Details\n          </h3>\n          <p><span class="font-medium">Applicant Name:</span> ${e.name}</p>\n          <p><span class="font-medium">Application No:</span> ${e.applicationNo}</p>\n          <p><span class="font-medium">Amount:</span> ₹${e.fee}/-</p>\n          <p><span class="font-medium">Date & Time:</span> ${e.attemptDateTime}</p>\n          ${e.error?`\n            <p class="mt-2 p-3 rounded-lg" style="background-color: ${n.primaryColor}10; color: ${n.primaryColor};">\n              <span class="font-medium">Error Message:</span> ${e.error}\n            </p>\n          `:""}\n        </div>\n\n        \x3c!-- Failure Reasons --\x3e\n        <div \n          class="mb-6"\n          style="\n            color: ${n.textColor};\n            font-family: ${n.fontFamily};\n          "\n        >\n          <h3 \n            class="text-lg font-semibold mb-3"\n            style="color: ${n.textColor};"\n          >\n            Possible Reasons for Failure\n          </h3>\n          <ul class="space-y-2 text-sm">\n            <li class="flex items-center">\n              <span \n                class="mr-2 rounded-full p-1"\n                style="background-color: ${n.primaryColor}20;"\n              >\n                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: ${n.primaryColor};">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n                </svg>\n              </span>\n              Insufficient funds in your account\n            </li>\n            <li class="flex items-center">\n              <span \n                class="mr-2 rounded-full p-1"\n                style="background-color: ${n.primaryColor}20;"\n              >\n                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: ${n.primaryColor};">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n                </svg>\n              </span>\n              Incorrect card details entered\n            </li>\n            <li class="flex items-center">\n              <span \n                class="mr-2 rounded-full p-1"\n                style="background-color: ${n.primaryColor}20;"\n              >\n                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: ${n.primaryColor};">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n                </svg>\n              </span>\n              Transaction declined by your bank\n            </li>\n            <li class="flex items-center">\n              <span \n                class="mr-2 rounded-full p-1"\n                style="background-color: ${n.primaryColor}20;"\n              >\n                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="color: ${n.primaryColor};">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n                </svg>\n              </span>\n              Network or connectivity issues\n            </li>\n          </ul>\n        </div>\n\n        \x3c!-- Action Buttons --\x3e\n        <div class="flex flex-col space-y-3">\n          <button \n            id="try-again-payment" \n            class="w-full font-bold py-2 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor};\n              color: ${n.backgroundColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${n.fontSize}px;\n            "\n          >\n            Try Again\n          </button>\n\n          <button \n            id="close-payment-failed" \n            class="w-full font-bold py-2 px-4 transition duration-300"\n            style="\n              background-color: ${n.primaryColor}20;\n              color: ${n.textColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${n.fontSize}px;\n            "\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  `);return setTimeout((()=>{const o=t.querySelector("#close-payment-failed"),a=t.querySelector("#try-again-payment");o.addEventListener("click",(()=>{N(t)})),a.addEventListener("click",(()=>{N(t),R(e,{onSuccess:n=>{q(O({...e,gateway:n.gateway,transactionId:n.razorpay_payment_id,paymentDateTime:(new Date).toLocaleString()}))},onError:t=>{q(B({...e,gateway:t.gateway,error:t.description,attemptDateTime:(new Date).toLocaleString()},n))},onModal:e=>{"DISMISSED"!==e&&"CANCELLED"!==e||L("Payment process cancelled","warning")}},{style:n})}))}),0),t}function V(e,n,t){e.classList.add("p-3","bg-white","rounded-lg");const a=document.createElement("h2");a.textContent=t.name||"Student Application Form",a.classList.add("text-2xl","font-semibold","mb-4"),a.style.color=t.style?.textColor||"#000000",e.appendChild(a),T();const i=D("otp-verification-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-md w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${(r=t.style).backgroundColor}; \n        color: ${r.textColor}; \n        font-family: ${r.fontFamily}; \n        font-size: ${r.fontSize}px; \n        gap: ${r.gap};\n      "\n    >\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${r.primaryColor}; \n          color: ${r.backgroundColor};\n          border-top-left-radius: ${r.borderRadius}px;\n          border-top-right-radius: ${r.borderRadius}px;\n        "\n      >\n        <h2 \n          class="text-2xl font-bold" \n          style="font-family: ${r.fontFamily};"\n        >\n          OTP Verification\n        </h2>\n      </div>\n\n      <div class="p-6" style="gap: ${r.gap};">\n        <div class="mb-6">\n          <p \n            class="mb-2" \n            style="\n              color: ${r.textColor}; \n              font-family: ${r.fontFamily};\n              font-size: ${r.fontSize}px;\n            "\n          >\n            Please enter the One Time Password to proceed with the Admission Process.\n          </p>\n          <p \n            class="text-sm" \n            style="\n              color: ${r.textColor}; \n              font-family: ${r.fontFamily};\n              font-size: ${parseInt(r.fontSize)-2}px;\n            "\n          >\n            An OTP has been sent to your registered mobile number and email address.\n          </p>\n        </div>\n        \n        <div class="flex justify-between mb-8" style="gap: ${r.gap};">\n          ${Array(6).fill().map((()=>`\n                <input\n                  class="w-12 h-12 border-2 text-center text-2xl font-semibold transition-all focus:outline-none"\n                  type="text"\n                  maxLength="1"\n                  inputmode="numeric"\n                  autocomplete="one-time-code"\n                  style="\n                    border-radius: ${r.borderRadius}px;\n                    color: ${r.textColor};\n                    font-family: ${r.fontFamily};\n                    background-color: ${r.backgroundColor};\n                    border-color: ${r.primaryColor}40;\n                    font-size: ${r.fontSize}px;\n                  "\n                />\n              `)).join("")}\n        </div>\n        \n        <button \n          id="validate-otp"\n          class="w-full font-bold py-2 px-4 transition duration-300 mb-6 focus:outline-none"\n          style="\n            background-color: ${r.primaryColor};\n            color: ${r.backgroundColor};\n            border-radius: ${r.borderRadius}px;\n            font-family: ${r.fontFamily};\n            font-size: ${r.fontSize}px;\n          "\n        >\n          Verify OTP\n        </button>\n        \n        <div \n          class="flex justify-between items-center"\n          style="gap: ${r.gap};"\n        >\n          <a \n            href="#" \n            id="wrong-number" \n            class="flex items-center transition duration-300"\n            style="\n              color: ${r.primaryColor};\n              font-family: ${r.fontFamily};\n              font-size: ${r.fontSize}px;\n            "\n          >\n            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>\n            </svg>\n            Wrong number?\n          </a>\n          <a \n            href="#" \n            id="resend-otp" \n            class="flex items-center transition duration-300 resend-otp"\n            style="\n              font-family: ${r.fontFamily};\n              font-size: ${r.fontSize}px;\n            "\n          >\n            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>\n            </svg>\n            Resend OTP\n          </a>\n        </div>\n        \n        <div \n          id="timer" \n          class="text-center mt-4"\n          style="\n            color: ${r.textColor};\n            font-family: ${r.fontFamily};\n            font-size: ${parseInt(r.fontSize)-2}px;\n          "\n        >\n          Resend available in <span id="countdown">30</span> seconds\n        </div>\n      </div>\n    </div>\n  `);var r;const l=function(e){return D("email-verification-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-md w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${e.backgroundColor}; \n        color: ${e.textColor}; \n        font-family: ${e.fontFamily}; \n        font-size: ${e.fontSize}px; \n        gap: ${e.gap};\n      "\n    >\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${e.primaryColor}; \n          color: ${e.backgroundColor};\n          border-top-left-radius: ${e.borderRadius}px;\n          border-top-right-radius: ${e.borderRadius}px;\n        "\n      >\n        <h2 class="text-2xl font-bold" style="font-family: ${e.fontFamily};">Email Verification</h2>\n        <p class="text-sm" style="font-family: ${e.fontFamily};">Enter verification code sent to your email</p>\n      </div>\n\n      <div class="p-6" style="gap: ${e.gap};">\n        <div class="mb-6">\n          <p \n            class="mb-2" \n            style="\n              color: ${e.textColor}; \n              font-family: ${e.fontFamily};\n              font-size: ${e.fontSize}px;\n            "\n          >\n            Please enter the One Time Password to verify your email address.\n          </p>\n          <p \n            class="text-sm" \n            style="\n              color: ${e.textColor}; \n              font-family: ${e.fontFamily};\n              font-size: ${parseInt(e.fontSize)-2}px;\n            "\n          >\n            An OTP has been sent to your email address.\n          </p>\n        </div>\n        \n        <div class="flex justify-between mb-8" style="gap: ${e.gap};">\n          ${Array(6).fill().map((()=>`\n                <input\n                  class="w-12 h-12 border-2 border-gray-300 text-center text-2xl font-semibold transition-all focus:outline-none"\n                  type="text"\n                  maxLength="1"\n                  inputmode="numeric"\n                  autocomplete="one-time-code"\n                  style="\n                    border-radius: ${e.borderRadius}px;\n                    color: ${e.textColor};\n                    font-family: ${e.fontFamily};\n                    background-color: ${e.backgroundColor};\n                    border-color: ${e.primaryColor}40;\n                    font-size: ${e.fontSize}px;\n                  "\n                />\n              `)).join("")}\n        </div>\n        \n        <button \n          id="verify-email"\n          class="w-full font-bold py-2 px-4 transition duration-300 mb-6 focus:outline-none"\n          style="\n            background-color: ${e.primaryColor};\n            color: ${e.backgroundColor};\n            border-radius: ${e.borderRadius}px;\n            font-family: ${e.fontFamily};\n            font-size: ${e.fontSize}px;\n          "\n        >\n          Verify Email\n        </button>\n        \n        <div \n          class="flex justify-between items-center text-sm"\n          style="gap: ${e.gap};"\n        >\n          <a \n            href="#" \n            id="wrong-email" \n            class="flex items-center transition duration-300"\n            style="\n              color: ${e.primaryColor};\n              font-family: ${e.fontFamily};\n              font-size: ${e.fontSize}px;\n            "\n          >\n            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>\n            </svg>\n            Wrong email?\n          </a>\n          <a \n            href="#" \n            id="resend-email-otp" \n            class="flex items-center transition duration-300"\n            style="\n              color: ${e.primaryColor};\n              font-family: ${e.fontFamily};\n              font-size: ${e.fontSize}px;\n            "\n          >\n            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>\n            </svg>\n            Resend OTP\n          </a>\n        </div>\n        \n        <div \n          id="email-timer" \n          class="text-center mt-4"\n          style="\n            color: ${e.textColor};\n            font-family: ${e.fontFamily};\n            font-size: ${parseInt(e.fontSize)-2}px;\n          "\n        >\n          Resend available in <span id="email-countdown">30</span> seconds\n        </div>\n      </div>\n    </div>\n  `)}(t.style),s=document.createElement("form");$(s,n,t),e.appendChild(s);const d={emailVerified:!1,mobileVerified:!1,emailOTP:null,mobileOTP:null};async function p(e){try{const n=l.querySelectorAll("input"),t=document.getElementById("verify-email"),o=document.getElementById("resend-email-otp"),a=document.getElementById("wrong-email");w("email","pending");const i=await m(e,t);d.emailOTP=i.data.otp,L("Verification code sent to your email!","success"),q(l),y("email-countdown",o),b(n),t.replaceWith(t.cloneNode(!0));document.getElementById("verify-email").onclick=async()=>{const e=Array.from(n).map((e=>e.value)).join("");try{e===d.emailOTP?(d.emailVerified=!0,w("email","verified"),N(l),L("Email verified successfully!","success"),"true"===s.dataset.pendingSubmit&&(s.dataset.pendingSubmit="false",g())):(w("email","invalid"),L("Invalid verification code","error"))}catch(e){w("email","invalid"),L("Verification failed","error")}},o.onclick=async a=>{if(a.preventDefault(),!o.classList.contains("text-gray-400")){const a=await m(e,t);d.emailOTP=a.data.otp,w("email","pending"),L("Verification code resent to your email","success"),y("email-countdown",o),n.forEach((e=>e.value="")),n[0].focus()}},a.onclick=e=>{e.preventDefault(),N(l);const n=s.querySelector('input[type="email"]');n.disabled=!1,n.focus(),w("email","")}}catch(e){throw N(l),w("email","invalid"),L("Failed to send verification email","error"),e}}async function u(e){try{if(!/^\d{10}$/.test(e))return L("Please enter a valid 10-digit mobile number","error"),void w("tel","invalid");q(i),w("tel","pending");const n=await f(e);d.mobileOTP=n.data.otp,L("Verification code sent to your mobile","success");const t=i.querySelectorAll("input");let o=document.getElementById("validate-otp"),a=document.getElementById("resend-otp"),r=document.getElementById("wrong-number");const l=o.cloneNode(!0),c=a.cloneNode(!0),p=r.cloneNode(!0);o.parentNode.replaceChild(l,o),a.parentNode.replaceChild(c,a),r.parentNode.replaceChild(p,r),o=l,a=c,r=p,b(t),y("countdown",a),o.addEventListener("click",(async()=>{const e=Array.from(t).map((e=>e.value)).join("");try{e===d.mobileOTP?(d.mobileVerified=!0,N(i),w("tel","verified"),L("Mobile verified successfully!","success"),"true"===s.dataset.pendingSubmit&&(s.dataset.pendingSubmit="false",g())):(w("tel","invalid"),L("Invalid OTP","error"))}catch(e){w("tel","invalid"),L("Verification failed","error")}})),a.addEventListener("click",(async n=>{if(n.preventDefault(),!a.classList.contains("text-gray-400"))try{const n=await f(e);d.mobileOTP=n.data.otp,w("tel","pending"),L("OTP resent successfully","success"),t.forEach((e=>{e.value=""})),t[0].focus(),y("countdown",a)}catch(e){L("Failed to resend OTP","error")}})),r.addEventListener("click",(e=>{e.preventDefault(),N(i);const n=s.querySelector('input[type="tel"]');n&&(n.disabled=!1,n.value="",w("tel",""),d.mobileVerified=!1,d.mobileOTP=null,n.focus())}))}catch(e){throw N(i),w("tel","neutral"),L("Failed to send verification code","error"),e}}function y(e,n){let o=30;const a=document.getElementById(e);n.dataset.timerId&&clearInterval(parseInt(n.dataset.timerId)),n.classList.add("text-gray-400"),n.classList.remove(`text-[${t.style.textColor}]`,`hover:text-[${t.style.textColor}]`);const i=setInterval((()=>{o<=0?(clearInterval(i),a.textContent="30",n.classList.remove("text-gray-400"),n.classList.add(`text-[${t.style.textColor}]`,`hover:text-[${t.style.textColor}]`)):(a.textContent=o,o--)}),1e3);n.dataset.timerId=i.toString()}function b(e){e.forEach(((n,t)=>{n.oninput=()=>{n.value=n.value.replace(/\D/g,""),n.value&&(t<e.length-1?e[t+1].focus():e[t].blur())},n.onkeydown=o=>{"Backspace"===o.key&&t>0&&!n.value&&e[t-1].focus()},n.onpaste=n=>{n.preventDefault();const o=n.clipboardData.getData("text").replace(/\D/g,"").split("");o.forEach(((n,o)=>{e[t+o]&&(e[t+o].value=n)})),e[Math.min(t+o.length,e.length-1)].focus()}}))}async function g(){const e=new FormData(s),t=e.get("email"),o=e.get("mobile"),a={emailVerified:d.emailVerified,mobileVerified:d.mobileVerified};try{if(k(s,!0),e?.setup?.emailVerification&&e?.setup?.emailOptions?.afterSubmission&&!d.emailVerified)return s.dataset.pendingSubmit="true",void await p(t);if(e?.setup?.mobileVerification&&e?.setup?.mobileOptions?.mobileafterSubmission&&!d.mobileVerified)return s.dataset.pendingSubmit="true",void await u(o);const i=await async function(e,n,t){try{const o=Array.from(e.elements).filter((e=>e.getAttribute("data-field-id")&&e.value)).map((e=>({field_id:parseInt(e.getAttribute("data-field-id")),value:e.value}))),a={template_id:n.templateId,is_email_verified:t?.emailVerified||!1,is_mobile_verified:t?.mobileVerified||!1,fields_data:o},i=await fetch(c.SUBMIT_FORM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await i.json()}catch(e){throw console.error("Error submitting form:",e),e}}(s,n,a);console.log("Form submission result:",i?.data),i?.data?.addm_trans&&localStorage.setItem("addm_trans",JSON.stringify(i.data.addm_trans)),i?.data?.lead_id&&localStorage.setItem("admission_lead_id",i.data.lead_id),409===i.statusCode?h(i?.data.existing_data):201===i.statusCode&&x(i?.data)}catch(e){console.error("Form submission failed:",e),L("Form submission failed. Please try again.","error")}finally{k(s,!1)}}function h(e){console.log("Existing registrations:",e);const n=function(e=[],n){return D("existing-registration-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-2xl mx-auto overflow-hidden"\n      style="\n        background-color: ${n.backgroundColor}; \n        color: ${n.textColor}; \n        font-family: ${n.fontFamily}; \n        font-size: ${n.fontSize}px; \n        gap: ${n.gap};\n      "\n    >\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${n.primaryColor}; \n          color: ${n.backgroundColor};\n          border-top-left-radius: ${n.borderRadius}px;\n          border-top-right-radius: ${n.borderRadius}px;\n        "\n      >\n        <h2 \n          class="text-2xl font-bold"\n          style="font-family: ${n.fontFamily};"\n        >\n          Attention: Existing Registration Found\n        </h2>\n      </div>\n      <div class="p-6">\n        <p \n          class="mb-4"\n          style="\n            color: ${n.textColor}; \n            font-family: ${n.fontFamily};\n            font-size: ${n.fontSize}px;\n          "\n        >\n          We've detected that this mobile number is already associated with one or more registrations in ODM Public School.\n        </p>\n        <div class="space-y-4 overflow-y-auto max-h-96">\n          ${e?.map(((e,t)=>`\n            <div \n              class="rounded-lg p-4 border"\n              style="\n                background-color: ${n.backgroundColor}f0;\n                border-color: ${n.primaryColor}20;\n                border-radius: ${n.borderRadius}px;\n              "\n            >\n              <div class="flex items-center justify-between mb-2">\n                <div class="flex items-center">\n                  <div \n                    class="w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg mr-4"\n                    style="\n                      background-color: ${n.primaryColor}20;\n                      color: ${n.primaryColor};\n                    "\n                  >\n                    ${e?.student_name?.charAt(0)}${e?.student_name.split(" ")[1]?e?.student_name.split(" ")[1]?.charAt(0):""}\n                  </div>\n                  <div>\n                    <h3 \n                      class="font-semibold text-lg"\n                      style="\n                        color: ${n.textColor};\n                        font-family: ${n.fontFamily};\n                      "\n                    >${e?.student_name}</h3>\n                    <p \n                      class="text-sm"\n                      style="\n                        color: ${n.textColor}99;\n                        font-family: ${n.fontFamily};\n                      "\n                    >Application No: ${e?.application_id||e?.id||"N/A"}</p>\n                  </div>\n                </div>\n                <span \n                  class="px-2 py-1 text-xs font-semibold rounded-full"\n                  style="\n                    background-color: ${n.primaryColor}20;\n                    color: ${n.primaryColor};\n                    font-family: ${n.fontFamily};\n                  "\n                >\n                  ${e?.paymentstatus}\n                </span>\n              </div>\n              <div \n                class="grid grid-cols-2 gap-2 text-sm"\n                style="\n                  color: ${n.textColor};\n                  font-family: ${n.fontFamily};\n                  font-size: ${parseInt(n.fontSize)-2}px;\n                "\n              >\n                <p><span class="font-medium">School:</span> ${e?.bu_name}</p>\n                <p><span class="font-medium">Class:</span> ${e?.class_name}</p>\n                <p><span class="font-medium">Wing:</span> ${e?.wing_name}</p>\n                <p><span class="font-medium">Program:</span> ${e?.program}</p>\n                <p><span class="font-medium">Registered:</span> ${e?.registereddatetime}</p>\n                <p><span class="font-medium">Mobile:</span> ${e?.register_mobile_number||"N/A"}</p>\n                <p class="col-span-2"><span class="font-medium">Email:</span> ${e?.register_email_id}</p>\n              </div>\n              <div class="mt-4">\n                <button \n                  class="w-full px-4 py-2 transition duration-300"\n                  style="\n                    background-color: ${"Pending"===e?.paymentstatus?n.primaryColor:n.primaryColor+"99"};\n                    color: ${n.backgroundColor};\n                    border-radius: ${n.borderRadius}px;\n                    font-family: ${n.fontFamily};\n                    font-size: ${n.fontSize}px;\n                  "\n                >\n                  ${"Pending"===e?.paymentstatus?"Complete Registration":"Resend Confirmation Email"}\n                </button>\n              </div>\n            </div>\n          `)).join("")}\n        </div>\n        <div class="mt-6 text-center">\n          <button \n            id="register-another-child" \n            class="px-6 py-2 transition duration-300"\n            style="\n              background-color: ${n.primaryColor}20;\n              color: ${n.textColor};\n              border-radius: ${n.borderRadius}px;\n              font-family: ${n.fontFamily};\n              font-size: ${n.fontSize}px;\n            "\n          >\n            Register Another Child\n          </button>\n        </div>\n      </div>\n    </div>\n  `)}(e,t.style);q(n),n.querySelector("#register-another-child").onclick=()=>{N(n),s.reset()};n.querySelectorAll("button:not(#register-another-child)").forEach(((o,a)=>{o.onclick=()=>{const i=e[a];o.textContent.includes("Complete Registration")?(N(n),function(e){const n={name:e.student_name,applicationNo:e.application_id||e.id,school:e.bu_name,class:e.class_name,wing:e.wing_name,program:e.program,fee:e.paid_amount||e.fee||0,addm_trans:{...e?.addm_trans}},o=j(n,t.style);q(o),o.querySelector("#pay-application-fee").onclick=()=>{N(o),R({applicationdetails:{...n,email:e.register_email_id,mobile:e.register_mobile_number},addm_trans:n.addm_trans},{onSuccess:e=>{q(O({...n,gateway:e.gateway,transactionId:e.razorpay_payment_id,paymentDateTime:(new Date).toLocaleString()},t.style,t.setup))},onError:e=>{q(B({...n,gateway:e.gateway,error:e.description,attemptDateTime:(new Date).toLocaleString()},t.style))},onModal:e=>{"DISMISSED"!==e&&"CANCELLED"!==e||L("Payment process cancelled","warning")}},t)}}(i)):o.textContent.includes("Resend Confirmation")&&L("Confirmation email resent successfully!","success")}}))}function x(e){const n=e?.appointment||[];e.appointment=n;const a=j(e?.applicationdetails,t.style);q(a),a.querySelector("#request-appointment").onclick=()=>{N(a),function(e){console.log("Appointment request:",e);const n=function(e,n,t){const o=n||[],a=D("appointment-request-modal",`\n    <div \n      class="rounded-lg shadow-xl max-w-md w-full mx-auto overflow-hidden"\n      style="\n        background-color: ${t.backgroundColor}; \n        color: ${t.textColor}; \n        font-family: ${t.fontFamily}; \n        font-size: ${t.fontSize}px; \n        gap: ${t.gap};\n      "\n    >\n      \x3c!-- Header section remains the same --\x3e\n      <div \n        class="px-6 py-4" \n        style="\n          background-color: ${t.primaryColor}; \n          color: ${t.backgroundColor};\n          border-top-left-radius: ${t.borderRadius}px;\n          border-top-right-radius: ${t.borderRadius}px;\n        "\n      >\n        <h2 \n          class="text-2xl font-bold"\n          style="font-family: ${t.fontFamily};"\n        >\n          Hey ${e.name}!\n        </h2>\n        <p \n          class="text-sm"\n          style="\n            font-family: ${t.fontFamily};\n            color: ${t.backgroundColor};\n          "\n        >\n          Request an appointment for admission process\n        </p>\n      </div>\n\n      <div class="p-6">\n        \x3c!-- Application details section remains the same --\x3e\n        <div \n          class="mb-6 space-y-2"\n          style="\n            color: ${t.textColor};\n            font-family: ${t.fontFamily};\n            font-size: ${t.fontSize}px;\n          "\n        >\n          <p><span class="font-medium">School Applied for:</span> ${e.school}</p>\n          <p><span class="font-medium">Class Applied for:</span> ${e.class}</p>\n          <p><span class="font-medium">Wing Applied for:</span> ${e.wing}</p>\n          <p><span class="font-medium">Program Applied for:</span> ${e.program}</p>\n          <p><span class="font-medium">Application Form Fee:</span> Rs ${e.fee}/-</p>\n        </div>\n        \n        <form id="appointment-form" class="space-y-4">\n          \x3c!-- Date Selection --\x3e\n          <div>\n            <label \n              for="appointment-date" \n              class="block text-sm font-medium mb-1"\n              style="\n                color: ${t.textColor};\n                font-family: ${t.fontFamily};\n              "\n            >\n              Appointment Date:\n            </label>\n            <select \n              id="appointment-date" \n              name="appointment-date" \n              required\n              class="block w-full border rounded-md py-2 px-3 transition duration-300"\n              style="\n                background-color: ${t.backgroundColor};\n                color: ${t.textColor};\n                border-color: ${t.primaryColor}40;\n                border-radius: ${t.borderRadius}px;\n                font-family: ${t.fontFamily};\n                font-size: ${t.fontSize}px;\n              "\n            >\n              <option value="">Select date</option>\n             ${o.map((e=>{const n=new Date(e.date);return`\n    <option value="${e.date}" data-employee-id="${e.employee_id}">\n      ${n.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})} (${e.day.trim()})\n    </option>\n  `})).join("")}\n            </select>\n          </div>\n          \n          \x3c!-- Time Selection --\x3e\n          <div>\n            <label \n              for="appointment-time" \n              class="block text-sm font-medium mb-1"\n              style="\n                color: ${t.textColor};\n                font-family: ${t.fontFamily};\n              "\n            >\n              Appointment Time:\n            </label>\n            <select \n              id="appointment-time" \n              name="appointment-time" \n              required \n              disabled\n              class="block w-full border rounded-md py-2 px-3 transition duration-300"\n              style="\n                background-color: ${t.backgroundColor};\n                color: ${t.textColor};\n                border-color: ${t.primaryColor}40;\n                border-radius: ${t.borderRadius}px;\n                font-family: ${t.fontFamily};\n                font-size: ${t.fontSize}px;\n                opacity: 0.5;\n              "\n            >\n              <option value="">Select time</option>\n            </select>\n          </div>\n          \n          \x3c!-- Mode Selection --\x3e\n          <div>\n            <label \n              for="appointment-mode" \n              class="block text-sm font-medium mb-1"\n              style="\n                color: ${t.textColor};\n                font-family: ${t.fontFamily};\n              "\n            >\n              Appointment Mode:\n            </label>\n            <select \n              id="appointment-mode" \n              name="appointment-mode" \n              required\n              class="block w-full border rounded-md py-2 px-3 transition duration-300"\n              style="\n                background-color: ${t.backgroundColor};\n                color: ${t.textColor};\n                border-color: ${t.primaryColor}40;\n                border-radius: ${t.borderRadius}px;\n                font-family: ${t.fontFamily};\n                font-size: ${t.fontSize}px;\n              "\n            >\n              <option value="">Select mode</option>\n              ${e.appointmentModes.map((e=>`\n                <option value="${e.value}">${e.label}</option>\n              `)).join("")}\n            </select>\n          </div>\n        </form>\n        \n        \x3c!-- Buttons --\x3e\n        <div class="mt-6 flex flex-col space-y-3">\n          <button \n            id="submit-appointment-request" \n            class="w-full py-2 px-4 transition duration-300"\n            disabled\n            style="\n              background-color: ${t.primaryColor};\n              color: ${t.backgroundColor};\n              border-radius: ${t.borderRadius}px;\n              font-family: ${t.fontFamily};\n              font-size: ${t.fontSize}px;\n              opacity: 0.5;\n              cursor: not-allowed;\n            "\n          >\n            Submit Appointment Request\n          </button>\n          <button \n            id="cancel-appointment" \n            class="w-full py-2 px-4 transition duration-300"\n            style="\n              background-color: ${t.primaryColor}20;\n              color: ${t.textColor};\n              border-radius: ${t.borderRadius}px;\n              font-family: ${t.fontFamily};\n              font-size: ${t.fontSize}px;\n            "\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  `);return setTimeout((()=>{const e=a.querySelector("#appointment-date"),n=a.querySelector("#appointment-time");e.addEventListener("change",(e=>{const t=e.target.value,a=o.find((e=>e.date===t));n.innerHTML='<option value="">Select time</option>',n.disabled=!0,n.style.opacity="0.5",n.style.cursor="not-allowed",a&&a.time?.length>0&&([...a.time].sort(((e,n)=>e.label.localeCompare(n.label))).forEach((e=>{const t=document.createElement("option");t.value=`${e.label}`,t.textContent=e.label,t.setAttribute("data-slot-value",e.value),n.appendChild(t)})),n.disabled=!1,n.style.opacity="1",n.style.cursor="pointer")})),a.querySelectorAll("select").forEach((e=>{e.addEventListener("focus",(()=>{e.style.borderColor=t.primaryColor,e.style.boxShadow=`0 0 0 2px ${t.primaryColor}40`})),e.addEventListener("blur",(()=>{e.style.borderColor=`${t.primaryColor}40`,e.style.boxShadow="none"}))}))}),0),a}(e?.applicationdetails,e?.appointment,t.style);q(n);const a=n.querySelector("#appointment-form"),i=n.querySelector("#submit-appointment-request"),r=n.querySelector("#cancel-appointment");i.addEventListener("click",(async()=>{const t=new FormData(a),i=t.get("appointment-date"),r=a.querySelector("#appointment-date"),l=a.querySelector("#appointment-time"),s=l.options[l.selectedIndex],d=r.options[r.selectedIndex].getAttribute("data-employee-id"),p=localStorage.getItem("admission_lead_id");if(!p)return void L("Error: Lead ID not found. Please try again.","error");const[m,u]=s.value.split("-"),f={lead_id:parseInt(p),appointment_mode_id:parseInt(t.get("appointment-mode")),date:i.split("T")[0],day:new Date(i).toLocaleDateString("en-US",{weekday:"long"}),slot_start_time:m?.trim(),slot_end_time:u?.trim(),slot_id:parseInt(s.getAttribute("data-slot-value")),appointment_user_id:parseInt(d)};if(f.appointment_user_id)try{const t=await async function(e,n){try{o(n,!0,"Scheduling");const t=await fetch(c.REQUEST_APPOINTMENT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(console.log("Appointment response:",a),"error"===a.statusCode)throw new Error(a.message);return a}catch(e){throw console.error("Error requesting appointment:",e),e}finally{o(n,!1)}}(f);201===t.statusCode?(N(n),L("Appointment scheduled successfully!","success"),v(e)):L("Failed to schedule appointment. Please try again.","error")}catch(e){console.error("Appointment scheduling failed:",e),L("Failed to schedule appointment. Please try again.","error")}else L("Error: Employee ID not found. Please try again.","error")})),r.addEventListener("click",(()=>{N(n)}));const l=n.querySelector("#appointment-date"),s=n.querySelector("#appointment-time"),d=n.querySelector("#appointment-mode");function p(){const e=""!==l.value,n=""!==s.value,t=""!==d.value,o=e&&n&&t;i.disabled=!o,i.style.opacity=o?"1":"0.5",i.style.cursor=o?"pointer":"not-allowed"}[l,s,d].forEach((e=>{e.addEventListener("change",p)})),p()}(e)},a.querySelector("#pay-application-fee").onclick=()=>{N(a),R(e,{onSuccess:n=>{console.log("responsee payment2",n);q(O({...e,...n.applicationDetails.applicationdetails,gateway:n.gateway,transactionId:n.razorpay_payment_id,paymentDateTime:(new Date).toLocaleString(),...n.applicationDetails.applicationdetails},t.style,t.setup))},onError:n=>{q(B({...e,gateway:n.gateway,error:n.description}))},onModal:e=>{"DISMISSED"!==e&&"CANCELLED"!==e||L("Payment process cancelled","warning")}},t)}}function v(e){L("Initializing payment...","info"),console.log("Payment details:",e),M(e,{onSuccess:o=>{console.log("responsee payment",o);const a=O({...e,...o.applicationDetails.applicationdetails,transactionId:o.razorpay_payment_id,feePaid:e.fee},t.style,t.setup);q(a),L("Payment successful!","success"),a.querySelector("#resend-email").onclick=()=>{L("Payment receipt resent to your email!","success")},a.querySelector("#return-home").onclick=()=>{N(a),window.location.href=n.landing_page_url||"/"},a.querySelector("#download-link").onclick=e=>{e.preventDefault(),L("Downloading payment receipt...","info")}},onError:n=>{const t=B({...e,error:n.description,attemptDateTime:(new Date).toLocaleString()});q(t),L("Payment failed. Please try again.","error"),t.querySelector("#try-again").onclick=()=>{N(t),v(e)},t.querySelector("#contact-support").onclick=()=>{L("Connecting to support...","info")}},onModal:e=>{"DISMISSED"===e&&L("Payment cancelled","warning")}})}if(s.onsubmit=async e=>{e.preventDefault();const n=new FormData(s),t=n.get("email"),o=n.get("mobile");try{if(k(s,!0),n?.setup?.emailVerification&&n?.setup?.emailOptions?.beforeSubmission&&!d.emailVerified)return s.dataset.pendingSubmit="true",await p(t),void k(s,!1);if(n?.setup?.mobileVerification&&n?.setup?.mobileOptions?.mobilebeforeSubmission&&!d.mobileVerified)return s.dataset.pendingSubmit="true",await u(o),void k(s,!1);await g()}catch(e){console.error("Form submission failed:",e),L("An error occurred. Please try again.","error"),k(s,!1)}},t?.setup?.emailVerification&&t?.setup?.emailOptions?.beforeSubmission){const e=s.querySelector('input[type="email"]');e.onblur=()=>{e.value&&e.validity.valid&&!d.emailVerified&&p(e.value)}}if(t?.setup?.mobileVerification&&t?.setup?.mobileOptions?.mobilebeforeSubmission){const e=s.querySelector('input[type="tel"]');e.onblur=()=>{e.value&&e.validity.valid&&!d.mobileVerified&&u(e.value)}}}function H(e={}){const o={...n,...e},a=document.getElementById(o.formId);a&&(o.apiEndpoint&&o.templateId?fetch(`${c.FORM_DATA}?template_id=${o.templateId}`).then((e=>e.json())).then((e=>{const n={...t,...e?.data[0],fields:e?.data[0]?.fields?.map((e=>({...e})))};V(a,o,n)})).catch((e=>{console.error("Error fetching form data:",e),console.log("Using default form data"),V(a,o,t)})):(console.log("API endpoint or template ID not provided. Using default form data"),V(a,o,t)))}return window.ElernWidget={initializeWidget:H},e.initializeWidget=H,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
